<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Cosmos Catalog RGR</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 30px; line-height: 1.6; }
        .box { background: white; max-width: 900px; margin: 0 auto; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { color: #1a1a1a; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .item { padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .star { background: #fff9db; font-weight: bold; border-left: 6px solid #fcc419; }
        .planet { margin-left: 45px; background: #e7f5ff; border-left: 6px solid #339af0; }
        .moon { margin-left: 90px; background: #f8f9fa; border-left: 6px solid #adb5bd; font-style: italic; }
        .admin-btn { font-size: 12px; text-decoration: none; padding: 4px 8px; border-radius: 4px; background: #fff; border: 1px solid #dee2e6; color: #444; margin-left: 5px; }
        .admin-btn:hover { background: #f1f3f5; }
        .btn-del { color: #e03131; border-color: #ffc9c9; }
        .form-card { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #e9ecef; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ced4da; border-radius: 4px; }
        button { padding: 8px 15px; background: #228be6; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1c7ed6; }
        .auth-bar { margin-bottom: 20px; font-size: 14px; color: #495057; }
    </style>
</head>
<body>
<div class="box">
    <h1> Космічний Каталог</h1>

    <div class="auth-bar">
        <div sec:authorize="isAuthenticated()">
            Ви увійшли як: <b sec:authentication="name"></b> |
            <a th:href="@{/logout}" style="color: #d9480f;">Вийти</a>
        </div>
        <div sec:authorize="!isAuthenticated()">
            <a th:href="@{/login}">Увійти</a> | <a th:href="@{/register}">Реєстрація</a>
        </div>
    </div>

    <div th:if="${view == 'register'}" class="form-card">
        <h3> Створення акаунту</h3>
        <form th:action="@{/register}" method="post">
            <input type="text" name="username" placeholder="Логін" required>
            <input type="password" name="password" placeholder="Пароль" required>
            <button type="submit">Зареєструватися</button>
            <a th:href="@{/}" style="margin-left:10px;">Назад</a>
        </form>
    </div>

    <div sec:authorize="hasRole('ADMIN')" th:if="${view == 'main' or view == 'edit'}" class="form-card">
        <h3 th:text="${view == 'edit'} ? '️ Редагування об\'єкта' : ' Додати новий об\'єкт'"></h3>
        <form th:action="@{/save}" method="post">
            <input type="hidden" name="id" th:value="${obj != null ? obj.id : ''}">
            <input type="text" name="name" placeholder="Назва об'єкта" th:value="${obj != null ? obj.name : ''}" required>

            <select name="type">
                <option th:selected="${obj != null and obj.type == 'Зірка'}">Зірка</option>
                <option th:selected="${obj != null and obj.type == 'Планета'}">Планета</option>
                <option th:selected="${obj != null and obj.type == 'Супутник'}">Супутник</option>
            </select>

            <select name="parentId">
                <option th:value="null">-- Оберіть батька --</option>
                <option th:each="p : ${objects}"
                        th:value="${p.id}"
                        th:text="${p.name} + ' (' + ${p.type} + ')'"
                        th:selected="${obj != null and obj.parentId == p.id}"></option>
            </select>

            <button type="submit">Зберегти</button>
            <a th:if="${view == 'edit'}" th:href="@{/}" style="margin-left:10px;">Скасувати</a>
        </form>
    </div>

    <div th:if="${view == 'main'}">
        <h3> Ієрархія небесних тіл:</h3>

        <div th:each="star : ${objects}" th:if="${star.type == 'Зірка'}">
            <div class="item star">
                <span> <span th:text="${star.name}"></span> (Зірка)</span>
                <span sec:authorize="hasRole('ADMIN')">
                    <a th:href="@{'/edit/' + ${star.id}}" class="admin-btn">Ред.</a>
                    <a th:href="@{'/delete/' + ${star.id}}" class="admin-btn btn-del">Видалити</a>
                </span>
            </div>

            <div th:each="planet : ${objects}" th:if="${planet.parentId == star.id}">
                <div class="item planet">
                    <span> <span th:text="${planet.name}"></span> (Планета)</span>
                    <span sec:authorize="hasRole('ADMIN')">
                        <a th:href="@{'/edit/' + ${planet.id}}" class="admin-btn">Ред.</a>
                        <a th:href="@{'/delete/' + ${planet.id}}" class="admin-btn btn-del">Видалити</a>
                    </span>
                </div>

                <div th:each="moon : ${objects}" th:if="${moon.parentId == planet.id}">
                    <div class="item moon">
                        <span> <span th:text="${moon.name}"></span> (Супутник)</span>
                        <span sec:authorize="hasRole('ADMIN')">
                            <a th:href="@{'/edit/' + ${moon.id}}" class="admin-btn">Ред.</a>
                            <a th:href="@{'/delete/' + ${moon.id}}" class="admin-btn btn-del">Видалити</a>
                        </span>
                    </div>
                </div> </div> </div> </div>

</div>
</body>
</html>